<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Kharcha - Advanced Expense Tracker</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4cc9f0;
      --dark-color: #212529;
      --light-color: #f8f9fa;
    }
    
    body {
      background-color: #f5f7fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .navbar-brand {
      font-weight: 700;
      color: var(--primary-color) !important;
    }
    
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-bottom: 24px;
      transition: transform 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card-header {
      background-color: white;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      font-weight: 600;
      padding: 16px 20px;
      border-radius: 12px 12px 0 0 !important;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
    }
    
    .btn-primary:hover {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    
    .form-control, .form-select {
      border-radius: 8px;
      padding: 10px 15px;
      border: 1px solid #e0e0e0;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
    }
    
    .table {
      margin-bottom: 0;
    }
    
    .table th {
      font-weight: 600;
      color: var(--dark-color);
      border-top: none;
    }
    
    .table td {
      vertical-align: middle;
    }
    
    .category-badge {
      padding: 4px 10px;
      border-radius: 50px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: capitalize;
    }
    
    .food-badge { background-color: #e3f2fd; color: #1976d2; }
    .transport-badge { background-color: #e8f5e9; color: #388e3c; }
    .shopping-badge { background-color: #fff3e0; color: #e65100; }
    .bills-badge { background-color: #f3e5f5; color: #8e24aa; }
    .other-badge { background-color: #e0f7fa; color: #00acc1; }
    
    .stats-card {
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      color: white;
    }
    
    .total-expenses { background: linear-gradient(135deg, #4361ee, #3f37c9); }
    .food-expenses { background: linear-gradient(135deg, #4caf50, #2e7d32); }
    .transport-expenses { background: linear-gradient(135deg, #ff9800, #f57c00); }
    .shopping-expenses { background: linear-gradient(135deg, #e91e63, #c2185b); }
    
    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 0.875rem;
      opacity: 0.9;
    }
    
    .action-icon {
      color: #757575;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .action-icon:hover {
      color: var(--primary-color);
    }
    
    .footer {
      text-align: center;
      margin-top: 3rem;
      padding: 1.5rem 0;
      color: #757575;
      font-size: 0.875rem;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    @media (max-width: 768px) {
      .stat-value {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fas fa-wallet me-2"></i>Smart Kharcha
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i> Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#reports"><i class="fas fa-chart-pie me-1"></i> Reports</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#settings"><i class="fas fa-cog me-1"></i> Settings</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-4">
    <!-- Stats Cards -->
    <div class="row">
      <div class="col-md-3 col-sm-6">
        <div class="stats-card total-expenses">
          <div class="stat-value" id="total-amount">₹0</div>
          <div class="stat-label">Total Expenses</div>
          <i class="fas fa-chart-line float-end mt-2"></i>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="stats-card food-expenses">
          <div class="stat-value" id="food-amount">₹0</div>
          <div class="stat-label">Food & Dining</div>
          <i class="fas fa-utensils float-end mt-2"></i>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="stats-card transport-expenses">
          <div class="stat-value" id="transport-amount">₹0</div>
          <div class="stat-label">Transport</div>
          <i class="fas fa-car float-end mt-2"></i>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="stats-card shopping-expenses">
          <div class="stat-value" id="shopping-amount">₹0</div>
          <div class="stat-label">Shopping</div>
          <i class="fas fa-shopping-bag float-end mt-2"></i>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Add Expense Form -->
      <div class="col-lg-5">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="fas fa-plus-circle me-2"></i>Add New Expense</span>
          </div>
          <div class="card-body">
            <form id="expense-form">
              <div class="mb-3">
                <label for="desc" class="form-label">Description</label>
                <input type="text" class="form-control" id="desc" placeholder="e.g. Dinner at Restaurant" required />
              </div>
              <div class="mb-3">
                <label for="amount" class="form-label">Amount (₹)</label>
                <input type="number" class="form-control" id="amount" placeholder="e.g. 500" required />
              </div>
              <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category">
                  <option value="Food">Food & Dining</option>
                  <option value="Transport">Transport</option>
                  <option value="Shopping">Shopping</option>
                  <option value="Bills">Bills & Utilities</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="date" class="form-label">Date</label>
                <input type="date" class="form-control" id="date" required />
              </div>
              <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-save me-2"></i>Add Expense
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Chart Section -->
      <div class="col-lg-7">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="fas fa-chart-pie me-2"></i>Spending Overview</span>
            <select class="form-select form-select-sm w-auto" id="chart-period">
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="year">This Year</option>
              <option value="all" selected>All Time</option>
            </select>
          </div>
          <div class="card-body">
            <canvas id="expenseChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Expense Table -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="fas fa-list me-2"></i>Recent Expenses</span>
            <div class="input-group input-group-sm" style="width: 200px;">
              <input type="text" class="form-control" placeholder="Search..." id="search-expense">
              <button class="btn btn-outline-secondary" type="button">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0" id="expense-table">
                <thead>
                  <tr>
                    <th width="30%">Description</th>
                    <th width="15%">Amount</th>
                    <th width="15%">Category</th>
                    <th width="20%">Date</th>
                    <th width="20%">Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr class="fw-bold">
                    <td colspan="5" class="text-end">
                      Total: <span id="table-total">₹0</span>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      © 2023 Smart Kharcha | Design by Syed Ghina ul Hassan
    </div>
  </div>

  <!-- Edit Expense Modal -->
  <div class="modal fade" id="editExpenseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Expense</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="edit-expense-form">
            <input type="hidden" id="edit-id">
            <div class="mb-3">
              <label for="edit-desc" class="form-label">Description</label>
              <input type="text" class="form-control" id="edit-desc" required>
            </div>
            <div class="mb-3">
              <label for="edit-amount" class="form-label">Amount (₹)</label>
              <input type="number" class="form-control" id="edit-amount" required>
            </div>
            <div class="mb-3">
              <label for="edit-category" class="form-label">Category</label>
              <select class="form-select" id="edit-category">
                <option value="Food">Food & Dining</option>
                <option value="Transport">Transport</option>
                <option value="Shopping">Shopping</option>
                <option value="Bills">Bills & Utilities</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="edit-date" class="form-label">Date</label>
              <input type="date" class="form-control" id="edit-date" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="delete-expense-btn">Delete</button>
          <button type="button" class="btn btn-primary" id="save-expense-btn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // DOM Elements
    const form = document.getElementById('expense-form');
    const tableBody = document.querySelector('#expense-table tbody');
    const chartCtx = document.getElementById('expenseChart').getContext('2d');
    const totalAmountEl = document.getElementById('total-amount');
    const foodAmountEl = document.getElementById('food-amount');
    const transportAmountEl = document.getElementById('transport-amount');
    const shoppingAmountEl = document.getElementById('shopping-amount');
    const tableTotalEl = document.getElementById('table-total');
    const searchInput = document.getElementById('search-expense');
    const chartPeriodSelect = document.getElementById('chart-period');
    
    // Initialize variables
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    let expenseChart = null;
    let currentEditId = null;
    
    // Initialize date field with today's date
    document.getElementById('date').valueAsDate = new Date();
    
    // Category colors for chart
    const categoryColors = {
      'Food': '#4caf50',
      'Transport': '#ff9800',
      'Shopping': '#e91e63',
      'Bills': '#9c27b0',
      'Other': '#00bcd4'
    };
    
    // Helper function to format currency
    const formatCurrency = (amount) => {
      return '₹' + parseFloat(amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    };
    
    // Helper function to get category badge class
    const getCategoryBadge = (category) => {
      const classes = {
        'Food': 'food-badge',
        'Transport': 'transport-badge',
        'Shopping': 'shopping-badge',
        'Bills': 'bills-badge',
        'Other': 'other-badge'
      };
      return `<span class="category-badge ${classes[category]}">${category}</span>`;
    };
    
    // Update stats cards
    const updateStats = () => {
      const totals = {
        total: 0,
        Food: 0,
        Transport: 0,
        Shopping: 0,
        Bills: 0,
        Other: 0
      };
      
      expenses.forEach(exp => {
        const amount = parseFloat(exp.amount);
        totals.total += amount;
        totals[exp.category] += amount;
      });
      
      totalAmountEl.textContent = formatCurrency(totals.total);
      foodAmountEl.textContent = formatCurrency(totals.Food);
      transportAmountEl.textContent = formatCurrency(totals.Transport);
      shoppingAmountEl.textContent = formatCurrency(totals.Shopping);
      tableTotalEl.textContent = formatCurrency(totals.total);
    };
    
    // Update expense table
    const updateTable = (filteredExpenses = null) => {
      const expensesToShow = filteredExpenses || expenses;
      tableBody.innerHTML = '';
      
      if (expensesToShow.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-muted">No expenses found</td></tr>`;
        return;
      }
      
      expensesToShow.forEach((exp, index) => {
        const row = document.createElement('tr');
        row.dataset.id = exp.id;
        row.innerHTML = `
          <td>${exp.desc}</td>
          <td>${formatCurrency(exp.amount)}</td>
          <td>${getCategoryBadge(exp.category)}</td>
          <td>${new Date(exp.date).toLocaleDateString('en-IN')}</td>
          <td>
            <i class="fas fa-edit action-icon me-3 edit-btn" data-id="${exp.id}"></i>
            <i class="fas fa-trash-alt action-icon delete-btn" data-id="${exp.id}"></i>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      // Add event listeners to edit and delete buttons
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          editExpense(id);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.dataset.id;
          deleteExpense(id);
        });
      });
    };
    
    // Update chart
    const updateChart = (period = 'all') => {
      // Filter expenses based on period
      const now = new Date();
      let filteredExpenses = [...expenses];
      
      if (period === 'week') {
        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        filteredExpenses = expenses.filter(exp => new Date(exp.date) >= oneWeekAgo);
      } else if (period === 'month') {
        const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
        filteredExpenses = expenses.filter(exp => new Date(exp.date) >= oneMonthAgo);
      } else if (period === 'year') {
        const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
        filteredExpenses = expenses.filter(exp => new Date(exp.date) >= oneYearAgo);
      }
      
      // Calculate category totals
      const categoryTotals = {
        'Food': 0,
        'Transport': 0,
        'Shopping': 0,
        'Bills': 0,
        'Other': 0
      };
      
      filteredExpenses.forEach(exp => {
        categoryTotals[exp.category] += parseFloat(exp.amount);
      });
      
      // Prepare data for chart
      const labels = [];
      const data = [];
      const backgroundColors = [];
      
      Object.entries(categoryTotals).forEach(([category, total]) => {
        if (total > 0) {
          labels.push(category);
          data.push(total);
          backgroundColors.push(categoryColors[category]);
        }
      });
      
      // Destroy previous chart if exists
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      // Create new chart
      if (labels.length > 0) {
        expenseChart = new Chart(chartCtx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              data: data,
              backgroundColor: backgroundColors,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.label || '';
                    if (label) {
                      label += ': ';
                    }
                    label += formatCurrency(context.raw);
                    return label;
                  }
                }
              }
            },
            cutout: '65%'
          }
        });
      } else {
        // Show message when no data
        chartCtx.font = '16px Arial';
        chartCtx.fillStyle = '#999';
        chartCtx.textAlign = 'center';
        chartCtx.fillText('No data available', chartCtx.canvas.width / 2, chartCtx.canvas.height / 2);
      }
    };
    
    // Save expenses to localStorage
    const saveToLocalStorage = () => {
      localStorage.setItem('expenses', JSON.stringify(expenses));
      updateTable();
      updateStats();
      updateChart(chartPeriodSelect.value);
    };
    
    // Add new expense
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const desc = document.getElementById('desc').value.trim();
      const amount = document.getElementById('amount').value;
      const category = document.getElementById('category').value;
      const date = document.getElementById('date').value;
      
      const newExpense = {
        id: Date.now().toString(),
        desc,
        amount,
        category,
        date
      };
      
      expenses.push(newExpense);
      saveToLocalStorage();
      form.reset();
      document.getElementById('date').valueAsDate = new Date();
      
      // Show success toast
      const toast = new bootstrap.Toast(document.getElementById('successToast'));
      toast.show();
    });
    
    // Edit expense
    const editExpense = (id) => {
      const expense = expenses.find(exp => exp.id === id);
      if (!expense) return;
      
      currentEditId = id;
      document.getElementById('edit-id').value = expense.id;
      document.getElementById('edit-desc').value = expense.desc;
      document.getElementById('edit-amount').value = expense.amount;
      document.getElementById('edit-category').value = expense.category;
      document.getElementById('edit-date').value = expense.date;
      
      const modal = new bootstrap.Modal(document.getElementById('editExpenseModal'));
      modal.show();
    };
    
    // Save edited expense
    document.getElementById('save-expense-btn').addEventListener('click', () => {
      const id = document.getElementById('edit-id').value;
      const desc = document.getElementById('edit-desc').value.trim();
      const amount = document.getElementById('edit-amount').value;
      const category = document.getElementById('edit-category').value;
      const date = document.getElementById('edit-date').value;
      
      const index = expenses.findIndex(exp => exp.id === id);
      if (index !== -1) {
        expenses[index] = { id, desc, amount, category, date };
        saveToLocalStorage();
      }
      
      bootstrap.Modal.getInstance(document.getElementById('editExpenseModal')).hide();
    });
    
    // Delete expense
    const deleteExpense = (id) => {
      if (confirm('Are you sure you want to delete this expense?')) {
        expenses = expenses.filter(exp => exp.id !== id);
        saveToLocalStorage();
      }
    };
    
    // Delete expense from modal
    document.getElementById('delete-expense-btn').addEventListener('click', () => {
      if (confirm('Are you sure you want to delete this expense?')) {
        expenses = expenses.filter(exp => exp.id !== currentEditId);
        saveToLocalStorage();
        bootstrap.Modal.getInstance(document.getElementById('editExpenseModal')).hide();
      }
    });
    
    // Search expenses
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      if (searchTerm === '') {
        updateTable();
        return;
      }
      
      const filteredExpenses = expenses.filter(exp => 
        exp.desc.toLowerCase().includes(searchTerm) || 
        exp.category.toLowerCase().includes(searchTerm) ||
        exp.amount.toString().includes(searchTerm)
      );
      
      updateTable(filteredExpenses);
    });
    
    // Change chart period
    chartPeriodSelect.addEventListener('change', (e) => {
      updateChart(e.target.value);
    });
    
    // Initialize app
    const initApp = () => {
      // Add IDs to existing expenses if they don't have one (for backward compatibility)
      expenses = expenses.map(exp => {
        if (!exp.id) {
          return { ...exp, id: Date.now().toString() };
        }
        return exp;
      });
      
      updateTable();
      updateStats();
      updateChart();
    };
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>

  <!-- Success Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="successToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header bg-success text-white">
        <strong class="me-auto">Success</strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        Expense added successfully!
      </div>
    </div>
  </div>
</body>
</html>